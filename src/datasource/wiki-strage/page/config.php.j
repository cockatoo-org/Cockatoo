{"title":"config.php","origin":"*\u8a2d\u5b9a\u9805\u76ee\r\n**\r\n*****APP_OCCUPATION\r\n\u5358\u4e00\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3060\u3051\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u3044\u5834\u5408\u3001\u30d1\u30b9\u306e\u5197\u9577\u90e8\u5206\u3092\u30ab\u30c3\u30c8\u51fa\u6765\u308b\u3002\r\n\u30ab\u30c3\u30c8\u3057\u305f\u3044\u30d1\u30b9\u3092\u6307\u5b9a\u3059\u308b\u3002\r\n\/<application>\/<device>\r\n\r\n\u8907\u6570\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u5834\u5408\u306ffalse\r\n\r\n*****Mode\r\n\u958b\u767a\u74b0\u5883\uff1dDef::MODE_DEBUG\r\n\u672c\u756a\u74b0\u5883\uff1dDef::MODE_NORMAL\r\n\u3092\u63a8\u5968\r\n*****ErrorRedirect\r\n\u30b7\u30b9\u30c6\u30e0\u4e0a\u81f4\u547d\u7684\u306a\u30a8\u30e9\u30fc\u304c\u8d77\u304d\u305f\u969b\u306e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u5148\r\nCockatoo\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u5148\u3092\u4ee5\u4e0b\u306e\u90e8\u5206\u306b\u8a2d\u5b9a\u3067\u304d\u308b\u3002\r\n[\u9069\u5fdc\u9806]\r\n+\u30da\u30fc\u30b8\u30ec\u30a4\u30a2\u30a6\u30c8\r\n+\u5171\u901a\u30ec\u30a4\u30a2\u30a6\u30c8\r\n+config.php \u203b\u30b3\u30b3\r\n\r\n*****CommonCSS\r\n\u5171\u901aCSS\u540d\r\n*****CommonJS\r\n\u5171\u901aJS\u540d\r\n*****SESSION_COOKIE\r\n\u30bb\u30c3\u30b7\u30e7\u30f3\u30af\u30c3\u30ad\u540d\r\n*****RequestParser\r\nURL\u89e3\u6790\u30ed\u30b8\u30c3\u30af\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u305f\u3044\u5834\u5408\u306f\u6307\u5b9a\u3059\u308b\r\n*****DeviceSelector\r\n&color(#FF0000){T.B.D...};\r\n*****BeakPacker\r\nAPI\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30b7\u30ea\u30a2\u30e9\u30a4\u30b6\u3092\u6307\u5b9a\u3059\u308b\r\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306fPHP serialize\r\n\u5c06\u6765\u7684\u306b\u306fMessagepack\u306a\u3069\u304c\u6709\u529b\u30fb\u30fb\u30fb\r\n**Gateway\r\n*****IPCDirectory\r\nUnix\u30bd\u30b1\u30c3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\r\n*****ActionTimeout\r\nAPI\u30b5\u30fc\u30d0\u5fdc\u7b54\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\r\n**\u5909\u6570\r\n*****$BEAKS\r\nRPC\u30c9\u30e9\u30a4\u30d0\u6307\u5b9a\r\n:BeakFile:\r\n:BeakMongo:\r\n:BeakMemcached:\r\n:BeakMysql:\r\n:BeakAction:API\u30b3\u30fc\u30eb\u7528\u30fb\u76f4\u63a5\u95a2\u6570\u30b3\u30fc\u30eb\r\n:BeakProxy:API\u30b3\u30fc\u30eb\u30fbRPC\r\n*****$BeakLocation\r\n\u305d\u308c\u305e\u308c\u306e\u901a\u4fe1\u5148\r\n>>\u672c\u6765\u306f$BEAKS\u306b\u542b\u3081\u308b\u3079\u304d\u3001zookeeper\u306e\u30c7\u30fc\u30bf\u69cb\u9020\u3082\u542b\u3081\u3066\u691c\u8a0e\u4e2d\r\n**\r\n*****$UseMemcache\r\n\u30ad\u30e3\u30c3\u30b7\u30e5\u7528memcached\u3092\u6307\u5b9a\u3059\u308b\r\n\u4f7f\u308f\u306a\u3044\u5834\u5408\u306ffalse\r\n*****$UseZookeeper\r\n\u30af\u30e9\u30b9\u30bf\u69cb\u6210\u306e\u7ba1\u7406\u3092Zookeeper\u3067\u884c\u3046\u5834\u5408\u306f\u6307\u5b9a\u3059\u308b\r\n\u4f7f\u308f\u306a\u3044\u5834\u5408\u306ffalse\r\n*****$ZookeeperCacheFile\r\nZookeeper\u60c5\u5831\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\u30d5\u30a1\u30a4\u30eb\r\n*****$Loglv\r\n\u30ed\u30b0\u30ec\u30d9\u30eb\r\n*****$LogDataDump\r\n\u30ed\u30b0\u51fa\u529b\u306b\u8a73\u7d30\u30c0\u30f3\u30d7\u60c5\u5831\u3092\u542b\u3081\u308b\u304b\u5426\u304b\uff1f\r\n*****$LogFile\r\n\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u540d\r\n*****$Error2Die\r\n\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb\u30d0\u30b0\u306e\u56de\u907f\u7528\r\nhttpd\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u69cb\u6210\u6b21\u7b2c(mod_deflate\u306a\u3069)\r\n\u3067\u306f\u554f\u984c\u304c\u3042\u308b\u306e\u3067\u51fa\u6765\u308c\u3070\u4f7f\u3044\u305f\u304f\u306a\u3044\u30fb\u30fb\u30fb\r\n\r\n**\u30b7\u30b9\u30c6\u30e0\u7528\r\n*****$SYS_BEAKS\r\n*****$PID\r\n\r\n\r\n*Wiki\u8a2d\u5b9a\u30b5\u30f3\u30d7\u30eb\r\n*****cofing.php.wiki\r\n <?php\r\n \/**\r\n  * config.php - Wiki config\r\n  *  \r\n  * @access public\r\n  * @package cockatoo\r\n  * @author hiroaki.kubota <hiroaki.kubota@mail.rakuten.com> \r\n  * @version $Id$\r\n  * @copyright Copyright (C) 2011, rakuten \r\n  *\/\r\n namespace Cockatoo;\r\n chdir(dirname(__FILE__));\r\n $COCKATOO_ROOT=getenv('COCKATOO_ROOT');\r\n if ( ! $COCKATOO_ROOT ) {\r\n   $COCKATOO_ROOT=dirname(__FILE__) .'\/';\r\n   putenv('COCKATOO_ROOT='.$COCKATOO_ROOT);\r\n }\r\n # PHP settings\r\n ini_set('error_reporting',2039); # E_ALL & ^E_NOTICE\r\n ini_set('log_errors','On');\r\n ini_set('display_errors','Off');\r\n ini_set('error_log',$COCKATOO_ROOT . '\/logs\/php_error.log');\r\n \r\n \r\n require_once($COCKATOO_ROOT . 'def.php');\r\n \r\n class Config {\r\n   \/**\r\n    * Specify the application path if you want to run only one application on this domain.\r\n    *   ex> '\/wiki\/default'\r\n    * Service MODE\r\n    *   You should set Def::MODE_NORMAL in service environment.\r\n    *\/\r\n   const APP_OCCUPATION = '\/wiki\/default';\r\n   \r\n   \/**\r\n    * Service MODE\r\n    *   You should set Def::MODE_NORMAL in service environment.\r\n    *\/\r\n   const Mode           = Def::MODE_DEBUG;\r\n \r\n   \/**\r\n    * The redirect path that when unhandled error occured.\r\n    *\/\r\n   const ErrorRedirect  = '\/view';\r\n \r\n   \/**\r\n    * Path to files\r\n    *\/\r\n   const CommonCSS      = 'css\/cockatoo.css';\r\n   const CommonJs       = 'js\/cockatoo.js';\r\n \r\n   \/**\r\n    * Session cookie name\r\n    *\/\r\n   const SESSION_COOKIE = 'ALB_SESID';\r\n \r\n   \/**\r\n    * Request analizer\r\n    *\/\r\n   const RequestParser     = 'wiki\\WikiRequestParser';\r\n   const DeviceSelector    = 'Cockatoo\\DefaultDeviceSelector'; \r\n \r\n   \/**\r\n    * Beak serializer\r\n    *\/\r\n   const BeakPacker     = 'Cockatoo\\DefaultBeakPacker';\r\n \r\n   \/**\r\n    * Gateway socket path\r\n    *\/\r\n   const IPCDirectory   = '\/tmp';\r\n \r\n   const ActionTimeout  = 1000000;  \/\/ @@@ Actually, it's valid of the two times of the specified value ! so this means 10 sec.\r\n \r\n   \/**\r\n    * PID\r\n    *\/\r\n   static public $PID;\r\n   \/**\r\n    * BEAK drivers\r\n    *\/\r\n   static public $BEAKS;\r\n   \/**\r\n    * BEAK scheme-list\r\n    *\/\r\n   static public $SYS_BEAKS;\r\n   \/**\r\n    * Memcached switch for beak cache\r\n    *\/\r\n   static public $UseMemcache;\r\n   \/**\r\n    * Dynamic locator switch from zookeeper\r\n    *\/\r\n   static public $UseZookeeper;\r\n   static public $ZookeeperCacheFile;\r\n   static public $Zookeeper;\r\n   \/**\r\n    * Static locator\r\n    *\/\r\n   static public $BeakLocation;\r\n   \/**\r\n    * Log\r\n    *\/\r\n   static public $Loglv;\r\n   static public $LogDataDump;\r\n   static public $LogFile;\r\n   static public $LogBrl;\r\n   \/**\r\n    * Measure of the zmq socket leak\r\n    *\/\r\n   static public $Error2Die;\r\n \r\n   public static function init () {\r\n     if ( self::$init ) {\r\n       \/\/--------------------\r\n       \/\/ LOG settings\r\n       \/\/--------------------\r\n       self::$Loglv   = Def::LOGLV_TRACE;\r\n       self::$LogDataDump = true;\r\n       \/**\r\n        * Filename , STDOUT or STDIN\r\n        *\/\r\n       $COCKATOO_ROOT=getenv('COCKATOO_ROOT');\r\n       self::$LogFile = $COCKATOO_ROOT . '\/logs\/cockatoo.log';\r\n \r\n       \/\/--------------------\r\n       \/\/ Beak cache settings\r\n       \/\/--------------------\r\n       self::$UseMemcache         = false;\r\n \r\n       \/**\r\n        * BEAK Driver switch\r\n        *\/\r\n       \/\/ Local mode\r\n       self::$BEAKS = array (\r\n         Def::BP_CMS      => 'Cockatoo\\BeakFile'   ,\r\n         Def::BP_SESSION  => 'Cockatoo\\BeakFile'   ,\r\n         Def::BP_LAYOUT   => 'Cockatoo\\BeakFile'   ,\r\n         Def::BP_COMPONENT=> 'Cockatoo\\BeakFile'   ,\r\n         Def::BP_STATIC   => 'Cockatoo\\BeakFile'   ,\r\n         Def::BP_STRAGE   => 'Cockatoo\\BeakFile'   ,\r\n         Def::BP_ACTION   => 'Cockatoo\\BeakAction' ,\r\n         null\r\n         );\r\n \r\n       \/**\r\n        * Static locations.\r\n        *\r\n        *  @@@ Todo:\r\n        *    $BeakLocation should be merged with $BEAK but have to consider zookeeper ...\r\n        *\/\r\n       self::$BeakLocation = array (\r\n         'cms:\/\/services-cms\/'           => array('127.0.0.1:27017'),\r\n         'layout:\/\/core-layout\/'         => array('127.0.0.1:27017'),\r\n         'component:\/\/core-component\/'   => array('127.0.0.1:27017'),\r\n         'static:\/\/core-static\/'         => array('127.0.0.1:27017'),\r\n         'layout:\/\/wiki-layout\/'         => array('127.0.0.1:27017'),\r\n         'component:\/\/wiki-component\/'   => array('127.0.0.1:27017'),\r\n         'static:\/\/wiki-static\/'         => array('127.0.0.1:27017'),\r\n         'strage:\/\/wiki-strage\/'         => array('127.0.0.1:27017'),\r\n         'action:\/\/wiki-action\/'         => array('127.0.0.1:22651'),\r\n         'session:\/\/wiki-session\/'       => array('127.0.0.1:27017')\r\n         );\r\n       \/\/--------------------\r\n       \/\/ Zookeeper ( dynamic locations )\r\n       \/\/--------------------\r\n       self::$UseZookeeper        = false;\r\n \r\n       \/\/--------------------\r\n       \/\/ FOR SYSTEM\r\n       \/\/--------------------\r\n       self::$PID = posix_getpid();\r\n       self::$init = false;\r\n       \/\/ Domain suffix\r\n       self::$SYS_BEAKS = array (\r\n         Def::BP_SESSION  => 'session'  ,\r\n         Def::BP_LAYOUT   => 'layout'   ,\r\n         Def::BP_COMPONENT=> 'component',\r\n         Def::BP_STATIC   => 'static'   ,\r\n         Def::BP_STRAGE   => 'strage'   ,\r\n         Def::BP_ACTION   => 'action'   ,\r\n         Def::BP_SEARCH   => 'search'   ,\r\n         Def::BP_CMS      => 'cms',\r\n         null\r\n         );\r\n       \/\/ @@@ Todo: \r\n       \/\/   It sounds like there are some bugs about connection pool in some httpd_modules.\r\n       \/\/   Then we must kill the httpd process FORCIBLY...\r\n       self::$Error2Die = 10;\r\n       \/\/\r\n       if ( Config::Mode == Def::MODE_DEBUG ) {\r\n         ini_set('display_errors','On');\r\n       }\r\n     }\r\n   }\r\n   static private $init = true;\r\n }\r\n Config::init();\r\n \r\n require_once($COCKATOO_ROOT.'utils\/ClassLoader.php');\r\n \\ClassLoader::addClassPath($COCKATOO_ROOT.'libs');\r\n \r\n require_once($COCKATOO_ROOT.'utils\/log.php');\r\n","contents":[{"tag":"h2","attr":[],"children":[{"tag":"text","text":"\u8a2d\u5b9a\u9805\u76ee\r"}]},{"tag":"div","attr":{"class":"h2"},"children":[{"tag":"h3","attr":[],"children":[{"tag":"text","text":"\r"}]},{"tag":"div","attr":{"class":"h3"},"children":[{"tag":"div","attr":{"class":"h4"},"children":[{"tag":"div","attr":{"class":"h5"},"children":[{"tag":"h6","attr":[],"children":[{"tag":"text","text":"APP_OCCUPATION\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[{"tag":"text","children":[{"tag":"text","text":"\u5358\u4e00\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3060\u3051\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u3044\u5834\u5408\u3001\u30d1\u30b9\u306e\u5197\u9577\u90e8\u5206\u3092\u30ab\u30c3\u30c8\u51fa\u6765\u308b\u3002\r"},{"tag":"br","text":""}]},{"tag":"text","children":[{"tag":"text","text":"\u30ab\u30c3\u30c8\u3057\u305f\u3044\u30d1\u30b9\u3092\u6307\u5b9a\u3059\u308b\u3002\r"},{"tag":"br","text":""}]},{"tag":"text","children":[{"tag":"text","text":"\/<application>\/<device>\r"},{"tag":"br","text":""}]},{"tag":"text","children":[{"tag":"text","text":"\r"},{"tag":"br","text":""}]},{"tag":"text","children":[{"tag":"text","text":"\u8907\u6570\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u5834\u5408\u306ffalse\r"},{"tag":"br","text":""}]},{"tag":"text","children":[{"tag":"text","text":"\r"},{"tag":"br","text":""}]}]},{"tag":"h6","attr":[],"children":[{"tag":"text","text":"Mode\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[{"tag":"text","children":[{"tag":"text","text":"\u958b\u767a\u74b0\u5883\uff1dDef::MODE_DEBUG\r"},{"tag":"br","text":""}]},{"tag":"text","children":[{"tag":"text","text":"\u672c\u756a\u74b0\u5883\uff1dDef::MODE_NORMAL\r"},{"tag":"br","text":""}]},{"tag":"text","children":[{"tag":"text","text":"\u3092\u63a8\u5968\r"},{"tag":"br","text":""}]}]},{"tag":"h6","attr":[],"children":[{"tag":"text","text":"ErrorRedirect\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[{"tag":"text","children":[{"tag":"text","text":"\u30b7\u30b9\u30c6\u30e0\u4e0a\u81f4\u547d\u7684\u306a\u30a8\u30e9\u30fc\u304c\u8d77\u304d\u305f\u969b\u306e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u5148\r"},{"tag":"br","text":""}]},{"tag":"text","children":[{"tag":"text","text":"Cockatoo\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u5148\u3092\u4ee5\u4e0b\u306e\u90e8\u5206\u306b\u8a2d\u5b9a\u3067\u304d\u308b\u3002\r"},{"tag":"br","text":""}]},{"tag":"text","children":[{"tag":"text","text":"[\u9069\u5fdc\u9806]\r"},{"tag":"br","text":""}]},{"tag":"ol","attr":[],"children":[{"tag":"li","attr":[],"children":[{"tag":"text","text":"\u30da\u30fc\u30b8\u30ec\u30a4\u30a2\u30a6\u30c8\r"}]},{"tag":"li","attr":[],"children":[{"tag":"text","text":"\u5171\u901a\u30ec\u30a4\u30a2\u30a6\u30c8\r"}]},{"tag":"li","attr":[],"children":[{"tag":"text","text":"config.php \u203b\u30b3\u30b3\r"}]}]},{"tag":"text","children":[{"tag":"text","text":"\r"},{"tag":"br","text":""}]}]},{"tag":"h6","attr":[],"children":[{"tag":"text","text":"CommonCSS\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[{"tag":"text","children":[{"tag":"text","text":"\u5171\u901aCSS\u540d\r"},{"tag":"br","text":""}]}]},{"tag":"h6","attr":[],"children":[{"tag":"text","text":"CommonJS\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[{"tag":"text","children":[{"tag":"text","text":"\u5171\u901aJS\u540d\r"},{"tag":"br","text":""}]}]},{"tag":"h6","attr":[],"children":[{"tag":"text","text":"SESSION_COOKIE\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[{"tag":"text","children":[{"tag":"text","text":"\u30bb\u30c3\u30b7\u30e7\u30f3\u30af\u30c3\u30ad\u540d\r"},{"tag":"br","text":""}]}]},{"tag":"h6","attr":[],"children":[{"tag":"text","text":"RequestParser\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[{"tag":"text","children":[{"tag":"text","text":"URL\u89e3\u6790\u30ed\u30b8\u30c3\u30af\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u305f\u3044\u5834\u5408\u306f\u6307\u5b9a\u3059\u308b\r"},{"tag":"br","text":""}]}]},{"tag":"h6","attr":[],"children":[{"tag":"text","text":"DeviceSelector\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[{"tag":"text","children":[{"tag":"text","text":""},{"tag":"span","attr":{"style":"color:#FF0000"},"children":[{"tag":"text","text":"T.B.D..."}]},{"tag":"text","text":"\r"},{"tag":"br","text":""}]}]},{"tag":"h6","attr":[],"children":[{"tag":"text","text":"BeakPacker\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[{"tag":"text","children":[{"tag":"text","text":"API\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30b7\u30ea\u30a2\u30e9\u30a4\u30b6\u3092\u6307\u5b9a\u3059\u308b\r"},{"tag":"br","text":""}]},{"tag":"text","children":[{"tag":"text","text":"\u30c7\u30d5\u30a9\u30eb\u30c8\u306fPHP serialize\r"},{"tag":"br","text":""}]},{"tag":"text","children":[{"tag":"text","text":"\u5c06\u6765\u7684\u306b\u306fMessagepack\u306a\u3069\u304c\u6709\u529b\u30fb\u30fb\u30fb\r"},{"tag":"br","text":""}]}]}]}]}]},{"tag":"h3","attr":[],"children":[{"tag":"text","text":"Gateway\r"}]},{"tag":"div","attr":{"class":"h3"},"children":[{"tag":"div","attr":{"class":"h4"},"children":[{"tag":"div","attr":{"class":"h5"},"children":[{"tag":"h6","attr":[],"children":[{"tag":"text","text":"IPCDirectory\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[{"tag":"text","children":[{"tag":"text","text":"Unix\u30bd\u30b1\u30c3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\r"},{"tag":"br","text":""}]}]},{"tag":"h6","attr":[],"children":[{"tag":"text","text":"ActionTimeout\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[{"tag":"text","children":[{"tag":"text","text":"API\u30b5\u30fc\u30d0\u5fdc\u7b54\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\r"},{"tag":"br","text":""}]}]}]}]}]},{"tag":"h3","attr":[],"children":[{"tag":"text","text":"\u5909\u6570\r"}]},{"tag":"div","attr":{"class":"h3"},"children":[{"tag":"div","attr":{"class":"h4"},"children":[{"tag":"div","attr":{"class":"h5"},"children":[{"tag":"h6","attr":[],"children":[{"tag":"text","text":"$BEAKS\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[{"tag":"text","children":[{"tag":"text","text":"RPC\u30c9\u30e9\u30a4\u30d0\u6307\u5b9a\r"},{"tag":"br","text":""}]},{"tag":"dl","attr":[],"children":[{"tag":"dt","attr":[],"children":[{"tag":"text","text":"BeakFile"}]},{"tag":"dd","attr":[],"children":[{"tag":"text","text":"\r"}]}]},{"tag":"dl","attr":[],"children":[{"tag":"dt","attr":[],"children":[{"tag":"text","text":"BeakMongo"}]},{"tag":"dd","attr":[],"children":[{"tag":"text","text":"\r"}]}]},{"tag":"dl","attr":[],"children":[{"tag":"dt","attr":[],"children":[{"tag":"text","text":"BeakMemcached"}]},{"tag":"dd","attr":[],"children":[{"tag":"text","text":"\r"}]}]},{"tag":"dl","attr":[],"children":[{"tag":"dt","attr":[],"children":[{"tag":"text","text":"BeakMysql"}]},{"tag":"dd","attr":[],"children":[{"tag":"text","text":"\r"}]}]},{"tag":"dl","attr":[],"children":[{"tag":"dt","attr":[],"children":[{"tag":"text","text":"BeakAction"}]},{"tag":"dd","attr":[],"children":[{"tag":"text","text":"API\u30b3\u30fc\u30eb\u7528\u30fb\u76f4\u63a5\u95a2\u6570\u30b3\u30fc\u30eb\r"}]}]},{"tag":"dl","attr":[],"children":[{"tag":"dt","attr":[],"children":[{"tag":"text","text":"BeakProxy"}]},{"tag":"dd","attr":[],"children":[{"tag":"text","text":"API\u30b3\u30fc\u30eb\u30fbRPC\r"}]}]}]},{"tag":"h6","attr":[],"children":[{"tag":"text","text":"$BeakLocation\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[{"tag":"text","children":[{"tag":"text","text":"\u305d\u308c\u305e\u308c\u306e\u901a\u4fe1\u5148\r"},{"tag":"br","text":""}]},{"tag":"blockquote","attr":[],"children":[{"tag":"text","text":"\u672c\u6765\u306f$BEAKS\u306b\u542b\u3081\u308b\u3079\u304d\u3001zookeeper\u306e\u30c7\u30fc\u30bf\u69cb\u9020\u3082\u542b\u3081\u3066\u691c\u8a0e\u4e2d\r"},{"tag":"br","text":""}]}]}]}]}]},{"tag":"h3","attr":[],"children":[{"tag":"text","text":"\r"}]},{"tag":"div","attr":{"class":"h3"},"children":[{"tag":"div","attr":{"class":"h4"},"children":[{"tag":"div","attr":{"class":"h5"},"children":[{"tag":"h6","attr":[],"children":[{"tag":"text","text":"$UseMemcache\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[{"tag":"text","children":[{"tag":"text","text":"\u30ad\u30e3\u30c3\u30b7\u30e5\u7528memcached\u3092\u6307\u5b9a\u3059\u308b\r"},{"tag":"br","text":""}]},{"tag":"text","children":[{"tag":"text","text":"\u4f7f\u308f\u306a\u3044\u5834\u5408\u306ffalse\r"},{"tag":"br","text":""}]}]},{"tag":"h6","attr":[],"children":[{"tag":"text","text":"$UseZookeeper\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[{"tag":"text","children":[{"tag":"text","text":"\u30af\u30e9\u30b9\u30bf\u69cb\u6210\u306e\u7ba1\u7406\u3092Zookeeper\u3067\u884c\u3046\u5834\u5408\u306f\u6307\u5b9a\u3059\u308b\r"},{"tag":"br","text":""}]},{"tag":"text","children":[{"tag":"text","text":"\u4f7f\u308f\u306a\u3044\u5834\u5408\u306ffalse\r"},{"tag":"br","text":""}]}]},{"tag":"h6","attr":[],"children":[{"tag":"text","text":"$ZookeeperCacheFile\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[{"tag":"text","children":[{"tag":"text","text":"Zookeeper\u60c5\u5831\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\u30d5\u30a1\u30a4\u30eb\r"},{"tag":"br","text":""}]}]},{"tag":"h6","attr":[],"children":[{"tag":"text","text":"$Loglv\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[{"tag":"text","children":[{"tag":"text","text":"\u30ed\u30b0\u30ec\u30d9\u30eb\r"},{"tag":"br","text":""}]}]},{"tag":"h6","attr":[],"children":[{"tag":"text","text":"$LogDataDump\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[{"tag":"text","children":[{"tag":"text","text":"\u30ed\u30b0\u51fa\u529b\u306b\u8a73\u7d30\u30c0\u30f3\u30d7\u60c5\u5831\u3092\u542b\u3081\u308b\u304b\u5426\u304b\uff1f\r"},{"tag":"br","text":""}]}]},{"tag":"h6","attr":[],"children":[{"tag":"text","text":"$LogFile\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[{"tag":"text","children":[{"tag":"text","text":"\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u540d\r"},{"tag":"br","text":""}]}]},{"tag":"h6","attr":[],"children":[{"tag":"text","text":"$Error2Die\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[{"tag":"text","children":[{"tag":"text","text":"\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb\u30d0\u30b0\u306e\u56de\u907f\u7528\r"},{"tag":"br","text":""}]},{"tag":"text","children":[{"tag":"text","text":"httpd\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u69cb\u6210\u6b21\u7b2c(mod_deflate\u306a\u3069)\r"},{"tag":"br","text":""}]},{"tag":"text","children":[{"tag":"text","text":"\u3067\u306f\u554f\u984c\u304c\u3042\u308b\u306e\u3067\u51fa\u6765\u308c\u3070\u4f7f\u3044\u305f\u304f\u306a\u3044\u30fb\u30fb\u30fb\r"},{"tag":"br","text":""}]},{"tag":"text","children":[{"tag":"text","text":"\r"},{"tag":"br","text":""}]}]}]}]}]},{"tag":"h3","attr":[],"children":[{"tag":"text","text":"\u30b7\u30b9\u30c6\u30e0\u7528\r"}]},{"tag":"div","attr":{"class":"h3"},"children":[{"tag":"div","attr":{"class":"h4"},"children":[{"tag":"div","attr":{"class":"h5"},"children":[{"tag":"h6","attr":[],"children":[{"tag":"text","text":"$SYS_BEAKS\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[]},{"tag":"h6","attr":[],"children":[{"tag":"text","text":"$PID\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[{"tag":"text","children":[{"tag":"text","text":"\r"},{"tag":"br","text":""}]},{"tag":"text","children":[{"tag":"text","text":"\r"},{"tag":"br","text":""}]}]}]}]}]}]},{"tag":"h2","attr":[],"children":[{"tag":"text","text":"Wiki\u8a2d\u5b9a\u30b5\u30f3\u30d7\u30eb\r"}]},{"tag":"div","attr":{"class":"h2"},"children":[{"tag":"div","attr":{"class":"h3"},"children":[{"tag":"div","attr":{"class":"h4"},"children":[{"tag":"div","attr":{"class":"h5"},"children":[{"tag":"h6","attr":[],"children":[{"tag":"text","text":"cofing.php.wiki\r"}]},{"tag":"div","attr":{"class":"h6"},"children":[{"tag":"pre","attr":[],"children":[{"tag":"text","text":"<?php"},{"tag":"text","text":"\/**"},{"tag":"text","text":" * config.php - Wiki config"},{"tag":"text","text":" *"},{"tag":"text","text":" * @access public"},{"tag":"text","text":" * @package cockatoo"},{"tag":"text","text":" * @author hiroaki.kubota <hiroaki.kubota@mail.rakuten.com>"},{"tag":"text","text":" * @version $Id$"},{"tag":"text","text":" * @copyright Copyright (C) 2011, rakuten"},{"tag":"text","text":" *\/"},{"tag":"text","text":"namespace Cockatoo;"},{"tag":"text","text":"chdir(dirname(__FILE__));"},{"tag":"text","text":"$COCKATOO_ROOT=getenv('COCKATOO_ROOT');"},{"tag":"text","text":"if ( ! $COCKATOO_ROOT ) {"},{"tag":"text","text":"  $COCKATOO_ROOT=dirname(__FILE__) .'\/';"},{"tag":"text","text":"  putenv('COCKATOO_ROOT='.$COCKATOO_ROOT);"},{"tag":"text","text":"}"},{"tag":"text","text":"# PHP settings"},{"tag":"text","text":"ini_set('error_reporting',2039); # E_ALL & ^E_NOTICE"},{"tag":"text","text":"ini_set('log_errors','On');"},{"tag":"text","text":"ini_set('display_errors','Off');"},{"tag":"text","text":"ini_set('error_log',$COCKATOO_ROOT . '\/logs\/php_error.log');"},{"tag":"text","text":""},{"tag":"text","text":""},{"tag":"text","text":"require_once($COCKATOO_ROOT . 'def.php');"},{"tag":"text","text":""},{"tag":"text","text":"class Config {"},{"tag":"text","text":"  \/**"},{"tag":"text","text":"   * Specify the application path if you want to run only one application on this domain."},{"tag":"text","text":"   *   ex> '\/wiki\/default'"},{"tag":"text","text":"   * Service MODE"},{"tag":"text","text":"   *   You should set Def::MODE_NORMAL in service environment."},{"tag":"text","text":"   *\/"},{"tag":"text","text":"  const APP_OCCUPATION = '\/wiki\/default';"},{"tag":"text","text":""},{"tag":"text","text":"  \/**"},{"tag":"text","text":"   * Service MODE"},{"tag":"text","text":"   *   You should set Def::MODE_NORMAL in service environment."},{"tag":"text","text":"   *\/"},{"tag":"text","text":"  const Mode           = Def::MODE_DEBUG;"},{"tag":"text","text":""},{"tag":"text","text":"  \/**"},{"tag":"text","text":"   * The redirect path that when unhandled error occured."},{"tag":"text","text":"   *\/"},{"tag":"text","text":"  const ErrorRedirect  = '\/view';"},{"tag":"text","text":""},{"tag":"text","text":"  \/**"},{"tag":"text","text":"   * Path to files"},{"tag":"text","text":"   *\/"},{"tag":"text","text":"  const CommonCSS      = 'css\/cockatoo.css';"},{"tag":"text","text":"  const CommonJs       = 'js\/cockatoo.js';"},{"tag":"text","text":""},{"tag":"text","text":"  \/**"},{"tag":"text","text":"   * Session cookie name"},{"tag":"text","text":"   *\/"},{"tag":"text","text":"  const SESSION_COOKIE = 'ALB_SESID';"},{"tag":"text","text":""},{"tag":"text","text":"  \/**"},{"tag":"text","text":"   * Request analizer"},{"tag":"text","text":"   *\/"},{"tag":"text","text":"  const RequestParser     = 'wiki\\WikiRequestParser';"},{"tag":"text","text":"  const DeviceSelector    = 'Cockatoo\\DefaultDeviceSelector';"},{"tag":"text","text":""},{"tag":"text","text":"  \/**"},{"tag":"text","text":"   * Beak serializer"},{"tag":"text","text":"   *\/"},{"tag":"text","text":"  const BeakPacker     = 'Cockatoo\\DefaultBeakPacker';"},{"tag":"text","text":""},{"tag":"text","text":"  \/**"},{"tag":"text","text":"   * Gateway socket path"},{"tag":"text","text":"   *\/"},{"tag":"text","text":"  const IPCDirectory   = '\/tmp';"},{"tag":"text","text":""},{"tag":"text","text":"  const ActionTimeout  = 1000000;  \/\/ @@@ Actually, it's valid of the two times of the specified value ! so this means 10 sec."},{"tag":"text","text":""},{"tag":"text","text":"  \/**"},{"tag":"text","text":"   * PID"},{"tag":"text","text":"   *\/"},{"tag":"text","text":"  static public $PID;"},{"tag":"text","text":"  \/**"},{"tag":"text","text":"   * BEAK drivers"},{"tag":"text","text":"   *\/"},{"tag":"text","text":"  static public $BEAKS;"},{"tag":"text","text":"  \/**"},{"tag":"text","text":"   * BEAK scheme-list"},{"tag":"text","text":"   *\/"},{"tag":"text","text":"  static public $SYS_BEAKS;"},{"tag":"text","text":"  \/**"},{"tag":"text","text":"   * Memcached switch for beak cache"},{"tag":"text","text":"   *\/"},{"tag":"text","text":"  static public $UseMemcache;"},{"tag":"text","text":"  \/**"},{"tag":"text","text":"   * Dynamic locator switch from zookeeper"},{"tag":"text","text":"   *\/"},{"tag":"text","text":"  static public $UseZookeeper;"},{"tag":"text","text":"  static public $ZookeeperCacheFile;"},{"tag":"text","text":"  static public $Zookeeper;"},{"tag":"text","text":"  \/**"},{"tag":"text","text":"   * Static locator"},{"tag":"text","text":"   *\/"},{"tag":"text","text":"  static public $BeakLocation;"},{"tag":"text","text":"  \/**"},{"tag":"text","text":"   * Log"},{"tag":"text","text":"   *\/"},{"tag":"text","text":"  static public $Loglv;"},{"tag":"text","text":"  static public $LogDataDump;"},{"tag":"text","text":"  static public $LogFile;"},{"tag":"text","text":"  static public $LogBrl;"},{"tag":"text","text":"  \/**"},{"tag":"text","text":"   * Measure of the zmq socket leak"},{"tag":"text","text":"   *\/"},{"tag":"text","text":"  static public $Error2Die;"},{"tag":"text","text":""},{"tag":"text","text":"  public static function init () {"},{"tag":"text","text":"    if ( self::$init ) {"},{"tag":"text","text":"      \/\/--------------------"},{"tag":"text","text":"      \/\/ LOG settings"},{"tag":"text","text":"      \/\/--------------------"},{"tag":"text","text":"      self::$Loglv   = Def::LOGLV_TRACE;"},{"tag":"text","text":"      self::$LogDataDump = true;"},{"tag":"text","text":"      \/**"},{"tag":"text","text":"       * Filename , STDOUT or STDIN"},{"tag":"text","text":"       *\/"},{"tag":"text","text":"      $COCKATOO_ROOT=getenv('COCKATOO_ROOT');"},{"tag":"text","text":"      self::$LogFile = $COCKATOO_ROOT . '\/logs\/cockatoo.log';"},{"tag":"text","text":""},{"tag":"text","text":"      \/\/--------------------"},{"tag":"text","text":"      \/\/ Beak cache settings"},{"tag":"text","text":"      \/\/--------------------"},{"tag":"text","text":"      self::$UseMemcache         = false;"},{"tag":"text","text":""},{"tag":"text","text":"      \/**"},{"tag":"text","text":"       * BEAK Driver switch"},{"tag":"text","text":"       *\/"},{"tag":"text","text":"      \/\/ Local mode"},{"tag":"text","text":"      self::$BEAKS = array ("},{"tag":"text","text":"        Def::BP_CMS      => 'Cockatoo\\BeakFile'   ,"},{"tag":"text","text":"        Def::BP_SESSION  => 'Cockatoo\\BeakFile'   ,"},{"tag":"text","text":"        Def::BP_LAYOUT   => 'Cockatoo\\BeakFile'   ,"},{"tag":"text","text":"        Def::BP_COMPONENT=> 'Cockatoo\\BeakFile'   ,"},{"tag":"text","text":"        Def::BP_STATIC   => 'Cockatoo\\BeakFile'   ,"},{"tag":"text","text":"        Def::BP_STRAGE   => 'Cockatoo\\BeakFile'   ,"},{"tag":"text","text":"        Def::BP_ACTION   => 'Cockatoo\\BeakAction' ,"},{"tag":"text","text":"        null"},{"tag":"text","text":"        );"},{"tag":"text","text":""},{"tag":"text","text":"      \/**"},{"tag":"text","text":"       * Static locations."},{"tag":"text","text":"       *"},{"tag":"text","text":"       *  @@@ Todo:"},{"tag":"text","text":"       *    $BeakLocation should be merged with $BEAK but have to consider zookeeper ..."},{"tag":"text","text":"       *\/"},{"tag":"text","text":"      self::$BeakLocation = array ("},{"tag":"text","text":"        'cms:\/\/services-cms\/'           => array('127.0.0.1:27017'),"},{"tag":"text","text":"        'layout:\/\/core-layout\/'         => array('127.0.0.1:27017'),"},{"tag":"text","text":"        'component:\/\/core-component\/'   => array('127.0.0.1:27017'),"},{"tag":"text","text":"        'static:\/\/core-static\/'         => array('127.0.0.1:27017'),"},{"tag":"text","text":"        'layout:\/\/wiki-layout\/'         => array('127.0.0.1:27017'),"},{"tag":"text","text":"        'component:\/\/wiki-component\/'   => array('127.0.0.1:27017'),"},{"tag":"text","text":"        'static:\/\/wiki-static\/'         => array('127.0.0.1:27017'),"},{"tag":"text","text":"        'strage:\/\/wiki-strage\/'         => array('127.0.0.1:27017'),"},{"tag":"text","text":"        'action:\/\/wiki-action\/'         => array('127.0.0.1:22651'),"},{"tag":"text","text":"        'session:\/\/wiki-session\/'       => array('127.0.0.1:27017')"},{"tag":"text","text":"        );"},{"tag":"text","text":"      \/\/--------------------"},{"tag":"text","text":"      \/\/ Zookeeper ( dynamic locations )"},{"tag":"text","text":"      \/\/--------------------"},{"tag":"text","text":"      self::$UseZookeeper        = false;"},{"tag":"text","text":""},{"tag":"text","text":"      \/\/--------------------"},{"tag":"text","text":"      \/\/ FOR SYSTEM"},{"tag":"text","text":"      \/\/--------------------"},{"tag":"text","text":"      self::$PID = posix_getpid();"},{"tag":"text","text":"      self::$init = false;"},{"tag":"text","text":"      \/\/ Domain suffix"},{"tag":"text","text":"      self::$SYS_BEAKS = array ("},{"tag":"text","text":"        Def::BP_SESSION  => 'session'  ,"},{"tag":"text","text":"        Def::BP_LAYOUT   => 'layout'   ,"},{"tag":"text","text":"        Def::BP_COMPONENT=> 'component',"},{"tag":"text","text":"        Def::BP_STATIC   => 'static'   ,"},{"tag":"text","text":"        Def::BP_STRAGE   => 'strage'   ,"},{"tag":"text","text":"        Def::BP_ACTION   => 'action'   ,"},{"tag":"text","text":"        Def::BP_SEARCH   => 'search'   ,"},{"tag":"text","text":"        Def::BP_CMS      => 'cms',"},{"tag":"text","text":"        null"},{"tag":"text","text":"        );"},{"tag":"text","text":"      \/\/ @@@ Todo:"},{"tag":"text","text":"      \/\/   It sounds like there are some bugs about connection pool in some httpd_modules."},{"tag":"text","text":"      \/\/   Then we must kill the httpd process FORCIBLY..."},{"tag":"text","text":"      self::$Error2Die = 10;"},{"tag":"text","text":"      \/\/"},{"tag":"text","text":"      if ( Config::Mode == Def::MODE_DEBUG ) {"},{"tag":"text","text":"        ini_set('display_errors','On');"},{"tag":"text","text":"      }"},{"tag":"text","text":"    }"},{"tag":"text","text":"  }"},{"tag":"text","text":"  static private $init = true;"},{"tag":"text","text":"}"},{"tag":"text","text":"Config::init();"},{"tag":"text","text":""},{"tag":"text","text":"require_once($COCKATOO_ROOT.'utils\/ClassLoader.php');"},{"tag":"text","text":"\\ClassLoader::addClassPath($COCKATOO_ROOT.'libs');"},{"tag":"text","text":""},{"tag":"text","text":"require_once($COCKATOO_ROOT.'utils\/log.php');"}]},{"tag":"text","children":[{"tag":"text","text":""},{"tag":"br","text":""}]}]}]}]}]}]}],"author":"guest","_u":"config.php"}