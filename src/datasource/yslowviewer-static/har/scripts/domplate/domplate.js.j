{"etag":"\"31a18d4e-6660-95b0-ee235bfe31dc71b1\"","type":"text\/javascript","exp":null,"desc":null,"data":"\nrequire.def(\"domplate\/domplate\",[],function(){Domplate={};(function(){function DomplateTag(tagName)\n{this.tagName=tagName;}\nthis.DomplateTag=DomplateTag;function DomplateEmbed()\n{}\nfunction DomplateLoop()\n{}\nvar womb=null;var domplate=function()\n{var lastSubject;for(var i=0;i<arguments.length;++i)\nlastSubject=lastSubject?copyObject(lastSubject,arguments[i]):arguments[i];for(var name in lastSubject)\n{var val=lastSubject[name];if(isTag(val))\n{if(val.tag.subject)\n{lastSubject[name]=val=copyObject({},val);val.tag=copyObject({},val.tag);}\nval.tag.subject=lastSubject;}}\nreturn lastSubject;};domplate.context=function(context,fn)\n{var lastContext=domplate.lastContext;domplate.topContext=context;fn.apply(context);domplate.topContext=lastContext;};this.domplate=domplate;this.create=domplate;this.TAG=function()\n{var embed=new DomplateEmbed();return embed.merge(arguments);};this.FOR=function()\n{var loop=new DomplateLoop();return loop.merge(arguments);};DomplateTag.prototype={merge:function(args,oldTag)\n{if(oldTag)\nthis.tagName=oldTag.tagName;this.context=oldTag?oldTag.context:null;this.subject=oldTag?oldTag.subject:null;this.attrs=oldTag?copyObject(oldTag.attrs):{};this.classes=oldTag?copyObject(oldTag.classes):{};this.props=oldTag?copyObject(oldTag.props):null;this.listeners=oldTag?copyArray(oldTag.listeners):null;this.children=oldTag?copyArray(oldTag.children):[];this.vars=oldTag?copyArray(oldTag.vars):[];var attrs=args.length?args[0]:null;var hasAttrs=typeof(attrs)==\"object\"&&!isTag(attrs);this.children=[];if(domplate.topContext)\nthis.context=domplate.topContext;if(args.length)\nparseChildren(args,hasAttrs?1:0,this.vars,this.children);if(hasAttrs)\nthis.parseAttrs(attrs);return creator(this,DomplateTag);},parseAttrs:function(args)\n{for(var name in args)\n{var val=parseValue(args[name]);readPartNames(val,this.vars);if(name.indexOf(\"on\")==0)\n{var eventName=$.browser.msie?name:name.substr(2);if(!this.listeners)\nthis.listeners=[];this.listeners.push(eventName,val);}\nelse if(name.indexOf(\"_\")==0)\n{var propName=name.substr(1);if(!this.props)\nthis.props={};this.props[propName]=val;}\nelse if(name.indexOf(\"$\")==0)\n{var className=name.substr(1);if(!this.classes)\nthis.classes={};this.classes[className]=val;}\nelse\n{if(name==\"class\"&&name in this.attrs)\nthis.attrs[name]+=\" \"+val;else\nthis.attrs[name]=val;}}},compile:function()\n{if(this.renderMarkup)\nreturn;this.compileMarkup();this.compileDOM();},compileMarkup:function()\n{this.markupArgs=[];var topBlock=[],topOuts=[],blocks=[],info={args:this.markupArgs,argIndex:0};this.generateMarkup(topBlock,topOuts,blocks,info);this.addCode(topBlock,topOuts,blocks);var fnBlock=['(function (__code__, __context__, __in__, __out__'];for(var i=0;i<info.argIndex;++i)\nfnBlock.push(', s',i);fnBlock.push(') {\\n');if(this.subject)\nfnBlock.push('with (this) {\\n');if(this.context)\nfnBlock.push('with (__context__) {\\n');fnBlock.push('with (__in__) {\\n');fnBlock.push.apply(fnBlock,blocks);if(this.subject)\nfnBlock.push('}\\n');if(this.context)\nfnBlock.push('}\\n');fnBlock.push('}})\\n');function __link__(tag,code,outputs,args)\n{tag.tag.compile();var tagOutputs=[];var markupArgs=[code,tag.tag.context,args,tagOutputs];markupArgs.push.apply(markupArgs,tag.tag.markupArgs);tag.tag.renderMarkup.apply(tag.tag.subject,markupArgs);outputs.push(tag);outputs.push(tagOutputs);}\nfunction __escape__(value)\n{function replaceChars(ch)\n{switch(ch)\n{case\"<\":return\"&lt;\";case\">\":return\"&gt;\";case\"&\":return\"&amp;\";case\"'\":return\"&#39;\";case'\"':return\"&quot;\";}\nreturn\"?\";};return String(value).replace(\/[<>&\"']\/g,replaceChars);}\nfunction __loop__(iter,outputs,fn)\n{var iterOuts=[];outputs.push(iterOuts);if(iter instanceof Array)\niter=new ArrayIterator(iter);try\n{while(1)\n{var value=iter.next();var itemOuts=[0,0];iterOuts.push(itemOuts);fn.apply(this,[value,itemOuts]);}}\ncatch(exc)\n{if(exc!=StopIteration)\nthrow exc;}}\nvar js=$.browser.msie?'var f = '+fnBlock.join(\"\")+';f':fnBlock.join(\"\");this.renderMarkup=eval(js);},getVarNames:function(args)\n{if(this.vars)\nargs.push.apply(args,this.vars);for(var i=0;i<this.children.length;++i)\n{var child=this.children[i];if(isTag(child))\nchild.tag.getVarNames(args);else if(child instanceof Parts)\n{for(var i=0;i<child.parts.length;++i)\n{if(child.parts[i]instanceof Variable)\n{var name=child.parts[i].name;var names=name.split(\".\");args.push(names[0]);}}}}},generateMarkup:function(topBlock,topOuts,blocks,info)\n{topBlock.push(',\"<',this.tagName,'\"');for(var name in this.attrs)\n{if(name!=\"class\")\n{var val=this.attrs[name];topBlock.push(', \" ',name,'=\\\\\"\"');addParts(val,',',topBlock,info,true);topBlock.push(', \"\\\\\"\"');}}\nif(this.listeners)\n{for(var i=0;i<this.listeners.length;i+=2)\nreadPartNames(this.listeners[i+1],topOuts);}\nif(this.props)\n{for(var name in this.props)\nreadPartNames(this.props[name],topOuts);}\nif(\"class\"in this.attrs||this.classes)\n{topBlock.push(', \" class=\\\\\"\"');if(\"class\"in this.attrs)\naddParts(this.attrs[\"class\"],',',topBlock,info,true);topBlock.push(', \" \"');for(var name in this.classes)\n{topBlock.push(', (');addParts(this.classes[name],'',topBlock,info);topBlock.push(' ? \"',name,'\" + \" \" : \"\")');}\ntopBlock.push(', \"\\\\\"\"');}\ntopBlock.push(',\">\"');this.generateChildMarkup(topBlock,topOuts,blocks,info);topBlock.push(',\"<\/',this.tagName,'>\"');},generateChildMarkup:function(topBlock,topOuts,blocks,info)\n{for(var i=0;i<this.children.length;++i)\n{var child=this.children[i];if(isTag(child))\nchild.tag.generateMarkup(topBlock,topOuts,blocks,info);else\naddParts(child,',',topBlock,info,true);}},addCode:function(topBlock,topOuts,blocks)\n{if(topBlock.length)\nblocks.push('__code__.push(\"\"',topBlock.join(\"\"),');\\n');if(topOuts.length)\nblocks.push('__out__.push(',topOuts.join(\",\"),');\\n');topBlock.splice(0,topBlock.length);topOuts.splice(0,topOuts.length);},addLocals:function(blocks)\n{var varNames=[];this.getVarNames(varNames);var map={};for(var i=0;i<varNames.length;++i)\n{var name=varNames[i];if(map.hasOwnProperty(name))\ncontinue;map[name]=1;var names=name.split(\".\");blocks.push('var ',names[0]+' = '+'__in__.'+names[0]+';\\n');}},compileDOM:function()\n{var path=[];var blocks=[];this.domArgs=[];path.embedIndex=0;path.loopIndex=0;path.staticIndex=0;path.renderIndex=0;var nodeCount=this.generateDOM(path,blocks,this.domArgs);var fnBlock=['(function (root, context, o'];for(var i=0;i<path.staticIndex;++i)\nfnBlock.push(', ','s'+i);for(var i=0;i<path.renderIndex;++i)\nfnBlock.push(', ','d'+i);fnBlock.push(') {\\n');for(var i=0;i<path.loopIndex;++i)\nfnBlock.push('var l',i,' = 0;\\n');for(var i=0;i<path.embedIndex;++i)\nfnBlock.push('var e',i,' = 0;\\n');if(this.subject)\nfnBlock.push('with (this) {\\n');if(this.context)\nfnBlock.push('with (context) {\\n');fnBlock.push(blocks.join(\"\"));if(this.subject)\nfnBlock.push('}\\n');if(this.context)\nfnBlock.push('}\\n');fnBlock.push('return ',nodeCount,';\\n');fnBlock.push('})\\n');function __prop__(object,prop,value)\n{object[prop]=value;}\nfunction __bind__(object,fn)\n{return function(event){return fn.apply(object,[event]);}}\nfunction __link__(node,tag,args)\n{tag.tag.compile();var domArgs=[node,tag.tag.context,0];domArgs.push.apply(domArgs,tag.tag.domArgs);domArgs.push.apply(domArgs,args);return tag.tag.renderDOM.apply(tag.tag.subject,domArgs);}\nvar self=this;function __loop__(iter,fn)\n{var nodeCount=0;for(var i=0;i<iter.length;++i)\n{iter[i][0]=i;iter[i][1]=nodeCount;nodeCount+=fn.apply(this,iter[i]);}\nreturn nodeCount;}\nfunction __path__(parent,offset)\n{var root=parent;for(var i=2;i<arguments.length;++i)\n{var index=arguments[i];if(i==3)\nindex+=offset;if(index==-1)\nparent=parent.parentNode;else\nparent=parent.childNodes[index];}\nreturn parent;}\nvar js=$.browser.msie?'var f = '+fnBlock.join(\"\")+';f':fnBlock.join(\"\");this.renderDOM=eval(js);},generateDOM:function(path,blocks,args)\n{if(this.listeners||this.props)\nthis.generateNodePath(path,blocks);if(this.listeners)\n{for(var i=0;i<this.listeners.length;i+=2)\n{var val=this.listeners[i+1];var arg=generateArg(val,path,args);if($.browser.msie)\nblocks.push('node.attachEvent(\"',this.listeners[i],'\", __bind__(this, ',arg,'));\\n');else\nblocks.push('node.addEventListener(\"',this.listeners[i],'\", __bind__(this, ',arg,'), false);\\n');}}\nif(this.props)\n{for(var name in this.props)\n{var val=this.props[name];var arg=generateArg(val,path,args);blocks.push(\"__prop__(node, '\"+name+\"', \"+arg+\");\\n\");}}\nthis.generateChildDOM(path,blocks,args);return 1;},generateNodePath:function(path,blocks)\n{blocks.push(\"var node = __path__(root, o\");for(var i=0;i<path.length;++i)\nblocks.push(\",\",path[i]);blocks.push(\");\\n\");},generateChildDOM:function(path,blocks,args)\n{path.push(0);for(var i=0;i<this.children.length;++i)\n{var child=this.children[i];if(isTag(child))\npath[path.length-1]+='+'+child.tag.generateDOM(path,blocks,args);else\npath[path.length-1]+='+1';}\npath.pop();}};DomplateEmbed.prototype=copyObject(DomplateTag.prototype,{merge:function(args,oldTag)\n{this.value=oldTag?oldTag.value:parseValue(args[0]);this.attrs=oldTag?oldTag.attrs:{};this.vars=oldTag?copyArray(oldTag.vars):[];var attrs=args[1];for(var name in attrs)\n{var val=parseValue(attrs[name]);this.attrs[name]=val;readPartNames(val,this.vars);}\nreturn creator(this,DomplateEmbed);},getVarNames:function(names)\n{if(this.value instanceof Parts)\nnames.push(this.value.parts[0].name);if(this.vars)\nnames.push.apply(names,this.vars);},generateMarkup:function(topBlock,topOuts,blocks,info)\n{this.addCode(topBlock,topOuts,blocks);blocks.push('__link__(');addParts(this.value,'',blocks,info);blocks.push(', __code__, __out__, {\\n');var lastName=null;for(var name in this.attrs)\n{if(lastName)\nblocks.push(',');lastName=name;var val=this.attrs[name];blocks.push('\"',name,'\":');addParts(val,'',blocks,info);}\nblocks.push('});\\n');},generateDOM:function(path,blocks,args)\n{var embedName='e'+path.embedIndex++;this.generateNodePath(path,blocks);var valueName='d'+path.renderIndex++;var argsName='d'+path.renderIndex++;blocks.push(embedName+' = __link__(node, ',valueName,', ',argsName,');\\n');return embedName;}});DomplateLoop.prototype=copyObject(DomplateTag.prototype,{merge:function(args,oldTag)\n{this.isLoop=true;this.varName=oldTag?oldTag.varName:args[0];this.iter=oldTag?oldTag.iter:parseValue(args[1]);this.vars=[];this.children=oldTag?copyArray(oldTag.children):[];var offset=Math.min(args.length,2);parseChildren(args,offset,this.vars,this.children);return creator(this,DomplateLoop);},getVarNames:function(names)\n{if(this.iter instanceof Parts)\nnames.push(this.iter.parts[0].name);DomplateTag.prototype.getVarNames.apply(this,[names]);},generateMarkup:function(topBlock,topOuts,blocks,info)\n{this.addCode(topBlock,topOuts,blocks);var iterName;if(this.iter instanceof Parts)\n{var part=this.iter.parts[0];iterName=part.name;if(part.format)\n{for(var i=0;i<part.format.length;++i)\niterName=part.format[i]+\"(\"+iterName+\")\";}}\nelse\niterName=this.iter;blocks.push('__loop__.apply(this, [',iterName,', __out__, function(',this.varName,', __out__) {\\n');this.generateChildMarkup(topBlock,topOuts,blocks,info);this.addCode(topBlock,topOuts,blocks);blocks.push('}]);\\n');},generateDOM:function(path,blocks,args)\n{var iterName='d'+path.renderIndex++;var counterName='i'+path.loopIndex;var loopName='l'+path.loopIndex++;if(!path.length)\npath.push(-1,0);var preIndex=path.renderIndex;path.renderIndex=0;var nodeCount=0;var subBlocks=[];var basePath=path[path.length-1];for(var i=0;i<this.children.length;++i)\n{path[path.length-1]=basePath+'+'+loopName+'+'+nodeCount;var child=this.children[i];if(isTag(child))\nnodeCount+='+'+child.tag.generateDOM(path,subBlocks,args);else\nnodeCount+='+1';}\npath[path.length-1]=basePath+'+'+loopName;blocks.push(loopName,' = __loop__.apply(this, [',iterName,', function(',counterName,',',loopName);for(var i=0;i<path.renderIndex;++i)\nblocks.push(',d'+i);blocks.push(') {\\n');blocks.push(subBlocks.join(\"\"));blocks.push('return ',nodeCount,';\\n');blocks.push('}]);\\n');path.renderIndex=preIndex;return loopName;}});function Variable(name,format)\n{this.name=name;this.format=format;}\nfunction Parts(parts)\n{this.parts=parts;}\nfunction parseParts(str)\n{var re=\/\\$([_A-Za-z][_A-Za-z0-9.|]*)\/g;var index=0;var parts=[];var m;while(m=re.exec(str))\n{var pre=str.substr(index,(re.lastIndex-m[0].length)-index);if(pre)\nparts.push(pre);var expr=m[1].split(\"|\");parts.push(new Variable(expr[0],expr.slice(1)));index=re.lastIndex;}\nif(!index)\nreturn str;var post=str.substr(index);if(post)\nparts.push(post);return new Parts(parts);}\nfunction parseValue(val)\n{return typeof(val)=='string'?parseParts(val):val;}\nfunction parseChildren(args,offset,vars,children)\n{for(var i=offset;i<args.length;++i)\n{var val=parseValue(args[i]);children.push(val);readPartNames(val,vars);}}\nfunction readPartNames(val,vars)\n{if(val instanceof Parts)\n{for(var i=0;i<val.parts.length;++i)\n{var part=val.parts[i];if(part instanceof Variable)\nvars.push(part.name);}}}\nfunction generateArg(val,path,args)\n{if(val instanceof Parts)\n{var vals=[];for(var i=0;i<val.parts.length;++i)\n{var part=val.parts[i];if(part instanceof Variable)\n{var varName='d'+path.renderIndex++;if(part.format)\n{for(var j=0;j<part.format.length;++j)\nvarName=part.format[j]+'('+varName+')';}\nvals.push(varName);}\nelse\nvals.push('\"'+part.replace(\/\"\/g,'\\\\\"')+'\"');}\nreturn vals.join('+');}\nelse\n{args.push(val);return's'+path.staticIndex++;}}\nfunction addParts(val,delim,block,info,escapeIt)\n{var vals=[];if(val instanceof Parts)\n{for(var i=0;i<val.parts.length;++i)\n{var part=val.parts[i];if(part instanceof Variable)\n{var partName=part.name;if(part.format)\n{for(var j=0;j<part.format.length;++j)\npartName=part.format[j]+\"(\"+partName+\")\";}\nif(escapeIt)\nvals.push(\"__escape__(\"+partName+\")\");else\nvals.push(partName);}\nelse\nvals.push('\"'+part+'\"');}}\nelse if(isTag(val))\n{info.args.push(val);vals.push('s'+info.argIndex++);}\nelse\nvals.push('\"'+val+'\"');var parts=vals.join(delim);if(parts)\nblock.push(delim,parts);}\nfunction isTag(obj)\n{return(typeof(obj)==\"function\"||obj instanceof Function)&&!!obj.tag;}\nfunction isDomplate(obj)\n{return(typeof(obj)==\"object\")&&!!obj.render;}\nfunction creator(tag,cons)\n{var fn=new Function(\"var tag = arguments.callee.tag;\"+\"var cons = arguments.callee.cons;\"+\"var newTag = new cons();\"+\"return newTag.merge(arguments, tag);\");fn.tag=tag;fn.cons=cons;extend(fn,Renderer);return fn;}\nfunction copyArray(oldArray)\n{var ary=[];if(oldArray)\nfor(var i=0;i<oldArray.length;++i)\nary.push(oldArray[i]);return ary;}\nfunction copyObject(l,r)\n{var m={};extend(m,l);extend(m,r);return m;}\nfunction extend(l,r)\n{for(var n in r)\nl[n]=r[n];}\nfunction ArrayIterator(array)\n{var index=-1;this.next=function()\n{if(++index>=array.length)\nthrow StopIteration;return array[index];};}\nfunction StopIteration(){}\nthis.$break=function()\n{throw StopIteration;};var Renderer={renderHTML:function(args,outputs,self)\n{var code=[];var markupArgs=[code,this.tag.context,args,outputs];markupArgs.push.apply(markupArgs,this.tag.markupArgs);this.tag.renderMarkup.apply(self?self:this.tag.subject,markupArgs);return code.join(\"\");},insertRows:function(args,before,self)\n{this.tag.compile();var outputs=[];var html=this.renderHTML(args,outputs,self);var doc=before.ownerDocument;var tableParent=doc.createElement(\"div\");tableParent.innerHTML=\"<table>\"+html+\"<\/table>\";var tbody=tableParent.firstChild.firstChild;var parent=before.tagName.toLowerCase()==\"tr\"?before.parentNode:before;var after=before.tagName.toLowerCase()==\"tr\"?before.nextSibling:null;var firstRow=tbody.firstChild,lastRow;while(tbody.firstChild)\n{lastRow=tbody.firstChild;if(after)\nparent.insertBefore(lastRow,after);else\nparent.appendChild(lastRow);}\nvar offset=0;if(this.tag.isLoop)\n{var node=firstRow.parentNode.firstChild;for(;node&&node!=firstRow;node=node.nextSibling)\n++offset;}\nvar domArgs=[firstRow,this.tag.context,offset];domArgs.push.apply(domArgs,this.tag.domArgs);domArgs.push.apply(domArgs,outputs);this.tag.renderDOM.apply(self?self:this.tag.subject,domArgs);return[firstRow,lastRow];},insertAfter:function(args,before,self)\n{this.tag.compile();var outputs=[];var html=this.renderHTML(args,outputs,self);var doc=before.ownerDocument;var range=doc.createRange();range.selectNode(doc.body);var frag=range.createContextualFragment(html);var root=frag.firstChild;if(before.nextSibling)\nbefore.parentNode.insertBefore(frag,before.nextSibling);else\nbefore.parentNode.appendChild(frag);var domArgs=[root,this.tag.context,0];domArgs.push.apply(domArgs,this.tag.domArgs);domArgs.push.apply(domArgs,outputs);this.tag.renderDOM.apply(self?self:(this.tag.subject?this.tag.subject:null),domArgs);return root;},replace:function(args,parent,self)\n{this.tag.compile();var outputs=[];var html=this.renderHTML(args,outputs,self);var root;if(parent.nodeType==1)\n{parent.innerHTML=html;root=parent.firstChild;}\nelse\n{if(!parent||parent.nodeType!=9)\nparent=document;if(!womb||womb.ownerDocument!=parent)\nwomb=parent.createElement(\"div\");womb.innerHTML=html;root=womb.firstChild;}\nvar domArgs=[root,this.tag.context,0];domArgs.push.apply(domArgs,this.tag.domArgs);domArgs.push.apply(domArgs,outputs);this.tag.renderDOM.apply(self?self:this.tag.subject,domArgs);return root;},append:function(args,parent,self)\n{this.tag.compile();var outputs=[];var html=this.renderHTML(args,outputs,self);if(!womb||womb.ownerDocument!=parent.ownerDocument)\nwomb=parent.ownerDocument.createElement(\"div\");womb.innerHTML=html;var root=womb.firstChild;while(womb.firstChild)\nparent.appendChild(womb.firstChild);var domArgs=[root,this.tag.context,0];domArgs.push.apply(domArgs,this.tag.domArgs);domArgs.push.apply(domArgs,outputs);this.tag.renderDOM.apply(self?self:this.tag.subject,domArgs);return root;},insertCols:function(args,parent,self)\n{this.tag.compile();var outputs=[];var html=this.renderHTML(args,outputs,self);var womb=parent.ownerDocument.createElement(\"div\");womb.innerHTML=\"<table><tbody><tr>\"+html+\"<\/tr><\/tbody><\/table>\";womb=womb.firstChild.firstChild.firstChild;var firstCol=womb.firstChild;if(!firstCol)\nreturn null;while(womb.firstChild)\nparent.appendChild(womb.firstChild);var offset=0;if(this.tag.isLoop)\n{var node=firstCol.parentNode.firstChild;for(;node&&node!=firstCol;node=node.nextSibling)\n++offset;}\nvar domArgs=[firstCol,this.tag.context,offset];domArgs.push.apply(domArgs,this.tag.domArgs);domArgs.push.apply(domArgs,outputs);this.tag.renderDOM.apply(self?self:this.tag.subject,domArgs);return firstCol;}};function defineTags()\n{for(var i=0;i<arguments.length;++i)\n{var tagName=arguments[i];var fn=new Function(\"var newTag = new Domplate.DomplateTag('\"+tagName+\"'); return newTag.merge(arguments);\");var fnName=tagName.toUpperCase();Domplate[fnName]=fn;}}\ndefineTags(\"a\",\"button\",\"br\",\"canvas\",\"col\",\"colgroup\",\"div\",\"fieldset\",\"form\",\"h1\",\"h2\",\"h3\",\"hr\",\"img\",\"input\",\"label\",\"legend\",\"li\",\"ol\",\"optgroup\",\"option\",\"p\",\"pre\",\"select\",\"span\",\"strong\",\"table\",\"tbody\",\"td\",\"textarea\",\"tfoot\",\"th\",\"thead\",\"tr\",\"tt\",\"ul\",\"code\",\"iframe\",\"canvas\");}).apply(Domplate);return Domplate;});","_u":"scripts\/domplate\/domplate.js"}